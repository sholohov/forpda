/**
 *		====================
 *		code lines numbering
 *		====================
 */

function numberingCodeLinesFoo() {
	var codeBlockAll = document.querySelectorAll('.post-block.code');
	for (var i = 0; i < codeBlockAll.length; i++) {
		var codeBlock = codeBlockAll[i],
		    codeTitle = codeBlock.querySelector('.block-title'),
		    codeBody = codeBlock.querySelector('.block-body'),
			newCode = codeBody.innerHTML.split('<br>'),
			count = '';

		while (~newCode[newCode.length - 1].search(/^\s*$/gi)) newCode.pop();
		codeTitle.insertAdjacentHTML("afterEnd", '<span class="toggle-btn"><span>PRE</span></span>');
		codeBody.innerHTML = '';
		for (var j = 0; j < newCode.length; j++) {
			var wrapLines = '<div class="line"><span class="num-wrap">' + (j + 1) + '</span>' + newCode[j] + '</div>';
			codeBody.insertAdjacentHTML("beforeEnd", wrapLines);
			count += (j + 1) + '\n';
		}
		codeBlock.insertAdjacentHTML("beforeEnd", '<div class="num-pre">' + count + '</div>');
		codeBlock.querySelector('.toggle-btn').addEventListener('click', onClickToggleButton);
	}
	function onClickToggleButton() {
		for (var i = 0; i < codeBlockAll.length; i++) {
			if (codeBlockAll[i].getAttribute('wraptext') == 'wrap') {
				codeBlockAll[i].setAttribute('wraptext', 'pre');
			} else codeBlockAll[i].setAttribute('wraptext', 'wrap');
		}
	}
}

document.addEventListener('DOMContentLoaded', numberingCodeLinesFoo);


